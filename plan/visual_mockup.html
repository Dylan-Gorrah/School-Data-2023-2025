<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lowryville School - Performance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #00bfff;
            --secondary-blue: #87ceeb;
            --accent-blue: #87cefa;
            --background: #f8f8ff;
            --text-dark: #2c3e50;
            --white: #ffffff;
            --gray-light: #f1f5f9;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: var(--white);
            padding: 80px 20px;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        /* Split Section Layout */
        .split-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
            margin-bottom: 80px;
        }

        .split-section.reverse {
            direction: rtl;
        }

        .split-section.reverse > * {
            direction: ltr;
        }

        .split-content h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .split-content p {
            font-size: 1.05rem;
            color: var(--text-dark);
            opacity: 0.75;
            line-height: 1.8;
            margin-bottom: 24px;
        }

        .split-visual {
            background: var(--white);
            border: 1px solid var(--secondary-blue);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 191, 255, 0.1);
            min-height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Stats Grid */
        .stats-horizontal {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 60px;
        }

        .stat-card {
            background: var(--white);
            border: 1px solid var(--secondary-blue);
            border-radius: 12px;
            padding: 28px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-blue);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 191, 255, 0.15);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 16px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            font-variant-numeric: tabular-nums;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-dark);
            opacity: 0.7;
            font-weight: 500;
        }

        /* Metric Cards */
        .metrics-row {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
        }

        .metric-card {
            flex: 1;
            background: var(--white);
            border: 1px solid var(--secondary-blue);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .metric-icon-wrapper {
            width: 56px;
            height: 56px;
            background: rgba(0, 191, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .metric-icon {
            width: 28px;
            height: 28px;
        }

        .metric-info h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 4px;
        }

        .metric-info p {
            font-size: 0.9rem;
            color: var(--text-dark);
            opacity: 0.7;
            margin: 0;
        }

        /* Chart placeholder */
        .chart-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(0, 191, 255, 0.05) 0%, 
                rgba(135, 206, 250, 0.1) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .chart-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Infrastructure Checklist Styles */
        .infrastructure-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .infrastructure-item {
            background: var(--white);
            border: 1px solid var(--secondary-blue);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 191, 255, 0.1);
        }

        .infrastructure-item h3 {
            margin-bottom: 15px;
            color: var(--primary-blue);
            font-size: 1.1rem;
            font-weight: 600;
        }

        .checklist {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .check-item:hover {
            background-color: var(--gray-light);
        }

        .check-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-blue);
            cursor: pointer;
        }

        .check-item span {
            font-size: 0.9rem;
            color: var(--text-dark);
            user-select: none;
        }

        .check-item input:checked + span {
            color: var(--primary-blue);
            font-weight: 600;
        }

        /* Comparison Table Styles */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 191, 255, 0.1);
        }

        .comparison-table th {
            padding: 10px;
            text-align: left;
            background: var(--gray-light);
            font-weight: 600;
            color: var(--text-dark);
        }

        .comparison-table td {
            padding: 8px;
            font-weight: 600;
            border-bottom: 1px solid var(--gray-light);
        }

        .comparison-table tbody tr:hover {
            background: var(--gray-light);
        }

        .comparison-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Year Selector */

        /* Year Selector */
        .year-selector {
            display: inline-flex;
            gap: 8px;
            background: var(--white);
            padding: 6px;
            border-radius: 10px;
            border: 1px solid var(--secondary-blue);
            margin-bottom: 32px;
        }

        .year-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .year-btn.active {
            background: var(--primary-blue);
            color: var(--white);
        }

        .year-btn:hover:not(.active) {
            background: var(--gray-light);
        }

        /* Full Width Section */
        .full-section {
            background: var(--white);
            border: 1px solid var(--secondary-blue);
            border-radius: 16px;
            padding: 48px;
            margin-bottom: 60px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        /* Info List */
        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 16px 0;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .info-list li:last-child {
            border-bottom: none;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            color: var(--primary-blue);
        }

        /* Mobile Responsive */
        @media (max-width: 968px) {
            .split-section {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .split-section.reverse {
                direction: ltr;
            }

            .stats-horizontal {
                grid-template-columns: repeat(2, 1fr);
            }

            .hero h1 {
                font-size: 2rem;
            }

            .metrics-row {
                flex-direction: column;
            }
        }

        @media (max-width: 640px) {
            .stats-horizontal {
                grid-template-columns: 1fr;
            }

            .hero {
                padding: 60px 20px;
            }

            .container {
                padding: 40px 20px;
            }

            .full-section {
                padding: 32px 24px;
            }

            .stat-number {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <div class="hero-content">
            <h1>Lowryville Intermedi√™re Skool</h1>
            <p>Performance Dashboard ¬∑ Grade R-9 ¬∑ 2023-2025</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        
        <!-- Key Stats Horizontal -->
        <div class="stats-horizontal">
            <div class="stat-card">
                <svg class="stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <div class="stat-number">1,143</div>
                <div class="stat-label">Total Learners (2025)</div>
            </div>
            
            <div class="stat-card">
                <svg class="stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div class="stat-number">92%</div>
                <div class="stat-label">Pass Rate 2025</div>
            </div>
            
            <div class="stat-card">
                <svg class="stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                <div class="stat-number">36</div>
                <div class="stat-label">Staff Members</div>
            </div>
            
            <div class="stat-card">
                <svg class="stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <div class="stat-number">Grade 9</div>
                <div class="stat-label">Exit Focus</div>
            </div>
        </div>

        <!-- Split Section: Text Left, Visual Right -->
        <div class="split-section">
            <div class="split-content">
                <h2>Enrollment Growth</h2>
                <p>Tracking learner enrollment across all grades from 2023 to 2025. Our school has seen consistent growth, particularly in foundation and intermediate phases.</p>
                
                <div class="year-selector">
                    <button class="year-btn" data-year="2023">2023</button>
                    <button class="year-btn" data-year="2024">2024</button>
                    <button class="year-btn" data-year="2025">2025</button>
                    <button class="year-btn active" data-year="all">All Years</button>
                </div>

                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-icon-wrapper">
                            <svg class="metric-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h3>+8.2%</h3>
                            <p>Growth since 2023</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="split-visual">
                <div class="chart-container">
                    <canvas id="enrollmentChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Split Section: Visual Left, Text Right -->
        <div class="split-section reverse">
            <div class="split-content">
                <h2>Academic Performance</h2>
                <p>Pass rates across all grades showing quarterly progression and year-over-year improvements. Our focus on Grade 9 preparation has yielded positive results.</p>
                
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-icon-wrapper">
                            <svg class="metric-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                        <div class="metric-info">
                            <h3>92%</h3>
                            <p>Overall Pass Rate</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="split-visual">
                <div class="chart-container">
                    <canvas id="passRateHeatmap"></canvas>
                </div>
            </div>
        </div>

        <!-- Full Width Section -->
        <div class="full-section">
            <div class="section-header">
                <h2 class="section-title">Grade 9 Subject Performance</h2>
                <div class="year-selector">
                    <button class="year-btn" data-year="2023">2023</button>
                    <button class="year-btn" data-year="2024">2024</button>
                    <button class="year-btn" data-year="2025">2025</button>
                    <button class="year-btn active" data-year="all">All Years</button>
                </div>
            </div>
            
            <div class="split-visual" style="min-height: 400px;">
                <div class="chart-container">
                    <canvas id="grade9SubjectsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Full Width Section: All Grades Subject Performance -->
        <div class="full-section">
            <div class="section-header">
                <h2 class="section-title">Subject Performance Across Grades</h2>
                <div class="year-selector">
                    <button class="year-btn" data-year="2023">2023</button>
                    <button class="year-btn" data-year="2024">2024</button>
                    <button class="year-btn" data-year="2025">2025</button>
                    <button class="year-btn active" data-year="all">All Years</button>
                </div>
            </div>
            
            <div class="chart-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                <div class="split-visual" style="min-height: 350px;">
                    <div class="chart-container">
                        <canvas id="grade4SubjectsChart"></canvas>
                    </div>
                </div>
                <div class="split-visual" style="min-height: 350px;">
                    <div class="chart-container">
                        <canvas id="grade5SubjectsChart"></canvas>
                    </div>
                </div>
                <div class="split-visual" style="min-height: 350px;">
                    <div class="chart-container">
                        <canvas id="grade6SubjectsChart"></canvas>
                    </div>
                </div>
                <div class="split-visual" style="min-height: 350px;">
                    <div class="chart-container">
                        <canvas id="grade7SubjectsChart"></canvas>
                    </div>
                </div>
                <div class="split-visual" style="min-height: 350px;">
                    <div class="chart-container">
                        <canvas id="grade8SubjectsChart"></canvas>
                    </div>
                </div>
                <div class="split-visual" style="min-height: 350px;">
                    <div class="chart-container">
                        <canvas id="grade9SubjectsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Split Section: Text Left, Visual Right -->
        <div class="split-section">
            <div class="split-content">
                <h2>School Profile</h2>
                <p>Our dedicated team of 36 staff members serves learners from Grade R through Grade 9, providing quality education in the Pixley-Ka-Seme district.</p>
                
                <ul class="info-list">
                    <li>
                        <svg class="info-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <div>
                            <strong>Leadership:</strong> 1 Principal, 2 Deputy Principals, 5 Department Heads
                        </div>
                    </li>
                    <li>
                        <svg class="info-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <div>
                            <strong>Location:</strong> Pixley-Ka-Seme District, Northern Cape
                        </div>
                    </li>
                    <li>
                        <svg class="info-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        <div>
                            <strong>Infrastructure:</strong> Focused on continuous improvement and development
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="split-visual">
                <div class="chart-container">
                    <canvas id="staffChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Infrastructure Improvement Section -->
        <div class="full-section">
            <div class="section-header">
                <h2 class="section-title">Infrastructure & Facility Improvements</h2>
                <p style="color: var(--text-dark); opacity: 0.7; margin: 0;">Check items that need attention or improvement</p>
            </div>
            
            <div class="infrastructure-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <div class="infrastructure-item">
                    <h3 style="margin-bottom: 15px; color: var(--primary-blue);">üè´ Classrooms & Learning Spaces</h3>
                    <div class="checklist">
                        <label class="check-item">
                            <input type="checkbox" name="classroom_maintenance">
                            <span>Classroom maintenance & repairs</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="lighting_upgrade">
                            <span>Lighting system upgrades</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="ventilation_improvement">
                            <span>Ventilation & air quality</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="furniture_replacement">
                            <span>Desk & chair replacements</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="smart_board_installation">
                            <span>Smart board installation</span>
                        </label>
                    </div>
                </div>

                <div class="infrastructure-item">
                    <h3 style="margin-bottom: 15px; color: var(--primary-blue);">üíß Water & Sanitation</h3>
                    <div class="checklist">
                        <label class="check-item">
                            <input type="checkbox" name="toilet_repairs">
                            <span>Toilet facility repairs</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="water_pressure">
                            <span>Water pressure improvement</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="handwashing_stations">
                            <span>Hand washing stations</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="water_tanks">
                            <span>Rainwater harvesting tanks</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="septic_system">
                            <span>Septic system maintenance</span>
                        </label>
                    </div>
                </div>

                <div class="infrastructure-item">
                    <h3 style="margin-bottom: 15px; color: var(--primary-blue);">‚ö° Electricity & Power</h3>
                    <div class="checklist">
                        <label class="check-item">
                            <input type="checkbox" name="generator_backup">
                            <span>Generator backup system</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="solar_panels">
                            <span>Solar panel installation</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="wiring_upgrade">
                            <span>Electrical wiring upgrade</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="outlet_installation">
                            <span>Additional power outlets</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="lightning_protection">
                            <span>Lightning protection</span>
                        </label>
                    </div>
                </div>

                <div class="infrastructure-item">
                    <h3 style="margin-bottom: 15px; color: var(--primary-blue);">üèÉ‚Äç‚ôÇÔ∏è Sports & Recreation</h3>
                    <div class="checklist">
                        <label class="check-item">
                            <input type="checkbox" name="sports_field_maintenance">
                            <span>Sports field maintenance</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="playground_equipment">
                            <span>Playground equipment repair</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="netball_posts">
                            <span>Netball posts installation</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="soccer_goals">
                            <span>Soccer goals & nets</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="athletics_track">
                            <span>Athletics track marking</span>
                        </label>
                    </div>
                </div>

                <div class="infrastructure-item">
                    <h3 style="margin-bottom: 15px; color: var(--primary-blue);">üîí Security & Safety</h3>
                    <div class="checklist">
                        <label class="check-item">
                            <input type="checkbox" name="fence_repair">
                            <span>Perimeter fence repair</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="security_gates">
                            <span>Security gate upgrade</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="cctv_installation">
                            <span>CCTV camera system</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="emergency_lighting">
                            <span>Emergency lighting</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="fire_extinguishers">
                            <span>Fire safety equipment</span>
                        </label>
                    </div>
                </div>

                <div class="infrastructure-item">
                    <h3 style="margin-bottom: 15px; color: var(--primary-blue);">üíª Technology & IT</h3>
                    <div class="checklist">
                        <label class="check-item">
                            <input type="checkbox" name="computer_lab_upgrade">
                            <span>Computer lab upgrades</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="internet_improvement">
                            <span>Internet bandwidth upgrade</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="wifi_coverage">
                            <span>Wi-Fi campus coverage</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="printer_replacement">
                            <span>Printer & scanner replacement</span>
                        </label>
                        <label class="check-item">
                            <input type="checkbox" name="projector_installation">
                            <span>Classroom projectors</span>
                        </label>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: var(--gray-light); border-radius: 8px;">
                <h4 style="margin-bottom: 10px; color: var(--text-dark);">üìã Improvement Summary</h4>
                <p style="margin: 0; color: var(--text-dark); opacity: 0.8;">
                    <strong id="checkedCount">0</strong> items selected for improvement ‚Ä¢ 
                    <strong id="priorityCount">0</strong> high-priority items
                </p>
            </div>
        </div>

    </div>

    <script>
        // Real school data from JSON file
        const schoolData = {
            "summary": {
                "2023": {
                    "quarters": {
                        "Q4": {
                            "enrollment": {"Grade_R": 78, "Grade_1": 156, "Grade_2": 136, "Grade_3": 156, "Grade_4": 143, "Grade_5": 113, "Grade_6": 154, "Grade_7": 68, "Grade_8": 48, "Grade_9": 45},
                            "pass_rates": {"Grade_R": 100.0, "Grade_1": 82.05, "Grade_2": 98.53, "Grade_3": 89.74, "Grade_4": 75.52, "Grade_5": 78.76, "Grade_6": 57.14, "Grade_7": 97.06, "Grade_8": 87.5, "Grade_9": 97.78},
                            "grade_averages": {"Grade_R": 73.19, "Grade_1": 65.46, "Grade_2": 74.26, "Grade_3": 67.06, "Grade_4": 60.44, "Grade_5": 56.34, "Grade_6": 56.84, "Grade_7": 57.63, "Grade_8": 55.0, "Grade_9": 53.82}
                        }
                    }
                },
                "2024": {
                    "quarters": {
                        "Q4": {
                            "enrollment": {"Grade_R": 116, "Grade_1": 134, "Grade_2": 135, "Grade_3": 149, "Grade_4": 163, "Grade_5": 124, "Grade_6": 111, "Grade_7": 91, "Grade_8": 73, "Grade_9": 62},
                            "pass_rates": {"Grade_R": 100.0, "Grade_1": 71.64, "Grade_2": 100.0, "Grade_3": 96.64, "Grade_4": 92.02, "Grade_5": 92.74, "Grade_6": 97.3, "Grade_7": 95.6, "Grade_8": 94.52, "Grade_9": 91.94},
                            "grade_averages": {"Grade_R": 79.13, "Grade_1": 63.75, "Grade_2": 74.44, "Grade_3": 65.26, "Grade_4": 56.36, "Grade_5": 53.61, "Grade_6": 56.66, "Grade_7": 52.11, "Grade_8": 49.71, "Grade_9": 52.24}
                        }
                    }
                },
                "2025": {
                    "quarters": {
                        "Q4": {
                            "enrollment": {"Grade_R": 90, "Grade_1": 157, "Grade_2": 102, "Grade_3": 137, "Grade_4": 147, "Grade_5": 153, "Grade_6": 114, "Grade_7": 100, "Grade_8": 72, "Grade_9": 67},
                            "pass_rates": {"Grade_R": 100.0, "Grade_1": 83.44, "Grade_2": 91.18, "Grade_3": 97.81, "Grade_4": 91.84, "Grade_5": 95.42, "Grade_6": 98.25, "Grade_7": 100.0, "Grade_8": 100.0, "Grade_9": 100.0},
                            "grade_averages": {"Grade_R": 79.8, "Grade_1": 70.55, "Grade_2": 67.02, "Grade_3": 64.8, "Grade_4": 63.14, "Grade_5": 56.15, "Grade_6": 59.85, "Grade_7": 53.87, "Grade_8": 54.64, "Grade_9": 54.67}
                        }
                    }
                }
            }
        };

        // Real subject data from extracted Excel files
        const subjectData = {
            "2024": {
                "Grade_4": [
                    {name: "Afrikaans Home Language", average: 59.7},
                    {name: "English First Additional Language", average: 53.8},
                    {name: "Life Skills", average: 68.8},
                    {name: "Mathematics", average: 46.8},
                    {name: "Natural Sciences and Technology", average: 57.6},
                    {name: "Social Sciences", average: 49.3}
                ],
                "Grade_5": [
                    {name: "Afrikaans Home Language", average: 55.3},
                    {name: "English First Additional Language", average: 56.2},
                    {name: "Life Skills", average: 63.3},
                    {name: "Mathematics", average: 48.8},
                    {name: "Natural Sciences and Technology", average: 50.6},
                    {name: "Social Sciences", average: 46.8}
                ],
                "Grade_6": [
                    {name: "Afrikaans Home Language", average: 64.1},
                    {name: "English First Additional Language", average: 60.5},
                    {name: "Life Skills", average: 62.4},
                    {name: "Mathematics", average: 54.2},
                    {name: "Natural Sciences and Technology", average: 47.8},
                    {name: "Social Sciences", average: 50.4}
                ],
                "Grade_7": [
                    {name: "Afrikaans Home Language", average: 58.5},
                    {name: "English First Additional Language", average: 61.2},
                    {name: "Life Orientation", average: 65.8},
                    {name: "Mathematics", average: 42.1},
                    {name: "Natural Sciences", average: 48.9},
                    {name: "Social Sciences", average: 52.3}
                ],
                "Grade_8": [
                    {name: "Afrikaans Home Language", average: 52.2},
                    {name: "Creative Arts", average: 63.0},
                    {name: "Economic Management Sciences", average: 43.5},
                    {name: "English First Additional Language", average: 66.5},
                    {name: "Life Orientation", average: 59.9},
                    {name: "Mathematics", average: 23.1},
                    {name: "Natural Sciences", average: 39.1},
                    {name: "Social Sciences", average: 48.3},
                    {name: "Technology", average: 50.3}
                ],
                "Grade_9": [
                    {name: "Afrikaans Home Language", average: 53.9},
                    {name: "Creative Arts", average: 62.0},
                    {name: "Economic Management Sciences", average: 41.7},
                    {name: "English First Additional Language", average: 62.2},
                    {name: "Life Orientation", average: 64.7},
                    {name: "Mathematics", average: 37.9},
                    {name: "Natural Sciences", average: 42.4},
                    {name: "Social Sciences", average: 48.0},
                    {name: "Technology", average: 56.8}
                ]
            }
        };

        // Staff data
        const staffData = {
            "Principal": 1,
            "Deputy Principals": 2,
            "Department Heads": 5,
            "Teachers": 28
        };

        // Chart configuration
        Chart.defaults.color = '#2c3e50';
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';

        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded!');
            setupYearButtons();
            updateEnrollmentChart();
            updatePassRateHeatmap();
            updateGrade9SubjectsChart();
            updateAllGradesSubjectCharts();
            initStaffChart();
            setupInfrastructureChecklist();
            loadSavedImprovements();
        });

        // Simple working year button setup
        function setupYearButtons() {
            const buttons = document.querySelectorAll('.year-btn');
            console.log('Found', buttons.length, 'year buttons');
            
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    console.log('Button clicked:', this.textContent);
                    
                    // Remove active from all buttons
                    buttons.forEach(b => b.classList.remove('active'));
                    // Add active to clicked button
                    this.classList.add('active');
                    
                    // Get selected year
                    currentSelectedYear = this.getAttribute('data-year');
                    console.log('Selected year:', currentSelectedYear);
                    
                    // Update charts
                    updateEnrollmentChart();
                    updatePassRateHeatmap();
                });
            });
        }

        // Enrollment Trends Chart
        function updateEnrollmentChart() {
            console.log('Updating enrollment chart for year:', currentSelectedYear);
            const ctx = document.getElementById('enrollmentChart').getContext('2d');
            const grades = ['R', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let datasets = [];
            
            if (currentSelectedYear === 'all') {
                datasets = [
                    {
                        label: '2023',
                        data: [78, 156, 136, 156, 143, 113, 154, 68, 48, 45],
                        borderColor: '#87ceeb',
                        backgroundColor: 'rgba(135, 206, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '2024',
                        data: [116, 134, 135, 149, 163, 124, 111, 91, 73, 62],
                        borderColor: '#00bfff',
                        backgroundColor: 'rgba(0, 191, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '2025',
                        data: [90, 157, 102, 137, 147, 153, 114, 100, 72, 67],
                        borderColor: '#87cefa',
                        backgroundColor: 'rgba(135, 206, 250, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ];
            } else {
                const yearData = {
                    '2023': [78, 156, 136, 156, 143, 113, 154, 68, 48, 45],
                    '2024': [116, 134, 135, 149, 163, 124, 111, 91, 73, 62],
                    '2025': [90, 157, 102, 137, 147, 153, 114, 100, 72, 67]
                };
                
                datasets = [{
                    label: currentYear,
                    data: yearData[currentYear],
                    borderColor: '#00bfff',
                    backgroundColor: 'rgba(0, 191, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }];
            }
            
            if (allCharts.enrollment) {
                allCharts.enrollment.destroy();
            }
            
            allCharts.enrollment = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: grades.map(g => `Grade ${g}`),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: 'Enrollment by Grade ' + (currentSelectedYear === 'all' ? '(2023-2025)' : `(${currentSelectedYear})`)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Number of Learners' }
                        }
                    }
                }
            });
        }

        // Pass Rate Chart
        function updatePassRateHeatmap() {
            console.log('Updating pass rate chart for year:', currentSelectedYear);
            const ctx = document.getElementById('passRateHeatmap').getContext('2d');
            const grades = ['R', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let datasets = [];
            
            if (currentSelectedYear === 'all') {
                datasets = [
                    {
                        label: '2023',
                        data: [100, 82.05, 98.53, 89.74, 75.52, 78.76, 57.14, 97.06, 87.5, 97.78],
                        backgroundColor: '#87ceeb'
                    },
                    {
                        label: '2024',
                        data: [100, 71.64, 100, 96.64, 92.02, 92.74, 97.3, 95.6, 94.52, 91.94],
                        backgroundColor: '#00bfff'
                    },
                    {
                        label: '2025',
                        data: [100, 83.44, 91.18, 97.81, 91.84, 95.42, 98.25, 100, 100, 100],
                        backgroundColor: '#87cefa'
                    }
                ];
            } else {
                const yearData = {
                    '2023': [100, 82.05, 98.53, 89.74, 75.52, 78.76, 57.14, 97.06, 87.5, 97.78],
                    '2024': [100, 71.64, 100, 96.64, 92.02, 92.74, 97.3, 95.6, 94.52, 91.94],
                    '2025': [100, 83.44, 91.18, 97.81, 91.84, 95.42, 98.25, 100, 100, 100]
                };
                
                datasets = [{
                    label: currentYear,
                    data: yearData[currentYear],
                    backgroundColor: '#00bfff'
                }];
            }
            
            if (allCharts.passRate) {
                allCharts.passRate.destroy();
            }
            
            allCharts.passRate = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: grades.map(g => `Grade ${g}`),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: 'Pass Rates by Grade ' + (currentSelectedYear === 'all' ? '(2023-2025)' : `(${currentSelectedYear}) (%)`)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Pass Rate (%)' }
                        }
                    }
                }
            });
        }

        // Grade 9 Subjects Chart (using Grade 8 data as closest available)
        function initGrade9SubjectsChart() {
            const ctx = document.getElementById('grade9SubjectsChart').getContext('2d');
            const grade8Subjects = subjectData['2024']['Grade_8']; // Using Grade 8 as proxy for Grade 9
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: grade8Subjects.map(s => s.name),
                    datasets: [{
                        label: 'Average Score (%)',
                        data: grade8Subjects.map(s => s.average),
                        backgroundColor: grade8Subjects.map(s => {
                            if (s.average >= 70) return '#51cf66';
                            if (s.average >= 60) return '#87ceeb';
                            if (s.average >= 50) return '#ffd43b';
                            return '#ff6b6b';
                        })
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Grade 8 Subject Performance (2024) - Exit Year Preparation'
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Average Score (%)'
                            }
                        }
                    }
                }
            });
        }

        // All Grades Subject Charts
        function initAllGradesSubjectCharts() {
            // Grade 4 Subjects
            const ctx4 = document.getElementById('grade4SubjectsChart').getContext('2d');
            const grade4Subjects = subjectData['2024']['Grade_4'];
            new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: grade4Subjects.map(s => s.name.replace(' (Gr 04)', '')),
                    datasets: [{
                        label: 'Average (%)',
                        data: grade4Subjects.map(s => s.average),
                        backgroundColor: grade4Subjects.map(s => {
                            if (s.average >= 70) return '#51cf66';
                            if (s.average >= 60) return '#87ceeb';
                            if (s.average >= 50) return '#ffd43b';
                            return '#ff6b6b';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Grade 4 Subjects' },
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // Grade 5 Subjects
            const ctx5 = document.getElementById('grade5SubjectsChart').getContext('2d');
            const grade5Subjects = subjectData['2024']['Grade_5'];
            new Chart(ctx5, {
                type: 'bar',
                data: {
                    labels: grade5Subjects.map(s => s.name.replace(' (Gr 05)', '')),
                    datasets: [{
                        label: 'Average (%)',
                        data: grade5Subjects.map(s => s.average),
                        backgroundColor: grade5Subjects.map(s => {
                            if (s.average >= 70) return '#51cf66';
                            if (s.average >= 60) return '#87ceeb';
                            if (s.average >= 50) return '#ffd43b';
                            return '#ff6b6b';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Grade 5 Subjects' },
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // Grade 6 Subjects
            const ctx6 = document.getElementById('grade6SubjectsChart').getContext('2d');
            const grade6Subjects = subjectData['2024']['Grade_6'];
            new Chart(ctx6, {
                type: 'bar',
                data: {
                    labels: grade6Subjects.map(s => s.name.replace(' (Gr 06)', '')),
                    datasets: [{
                        label: 'Average (%)',
                        data: grade6Subjects.map(s => s.average),
                        backgroundColor: grade6Subjects.map(s => {
                            if (s.average >= 70) return '#51cf66';
                            if (s.average >= 60) return '#87ceeb';
                            if (s.average >= 50) return '#ffd43b';
                            return '#ff6b6b';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Grade 6 Subjects' },
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // Grade 8 Subjects
            const ctx8 = document.getElementById('grade8SubjectsChart').getContext('2d');
            const grade8Subjects = subjectData['2024']['Grade_8'];
            new Chart(ctx8, {
                type: 'bar',
                data: {
                    labels: grade8Subjects.map(s => s.name.replace(' (Gr 08)', '')),
                    datasets: [{
                        label: 'Average (%)',
                        data: grade8Subjects.map(s => s.average),
                        backgroundColor: grade8Subjects.map(s => {
                            if (s.average >= 70) return '#51cf66';
                            if (s.average >= 60) return '#87ceeb';
                            if (s.average >= 50) return '#ffd43b';
                            return '#ff6b6b';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Grade 8 Subjects' },
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        // Staff Distribution Chart
        function initStaffChart() {
            const ctx = document.getElementById('staffChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(staffData),
                    datasets: [{
                        data: Object.values(staffData),
                        backgroundColor: [
                            '#00bfff',
                            '#87ceeb',
                            '#87cefa',
                            '#51cf66'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Staff Distribution by Role'
                        }
                    }
                }
            });
        }

        // Year selector functionality with actual data filtering
        let currentSelectedYear = 'all';
        let previousYear = 'all';
        let allCharts = {};

        function setupYearSelectors() {
            console.log('Setting up year selectors...'); // Debug log
            const yearSelectors = document.querySelectorAll('.year-selector');
            
            yearSelectors.forEach((selector, index) => {
                console.log(`Found year selector ${index + 1}`); // Debug log
                const buttons = selector.querySelectorAll('.year-btn');
                
                buttons.forEach((btn, btnIndex) => {
                    console.log(`Setting up button ${btnIndex}: ${btn.textContent}`); // Debug log
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Button clicked:', this.textContent, this.getAttribute('data-year')); // Debug log
                        
                        // Remove active class from all buttons in this selector
                        buttons.forEach(b => b.classList.remove('active'));
                        // Add active class to clicked button
                        this.classList.add('active');
                        
                        // Update selected year and refresh all charts
                        const newYear = this.getAttribute('data-year');
                        console.log('Changing year from', currentSelectedYear, 'to', newYear); // Debug log
                        currentSelectedYear = newYear;
                        updateAllCharts();
                    });
                });
            });
        }

        function updateAllCharts() {
            console.log('Updating all charts for year:', currentSelectedYear); // Debug log
            updateEnrollmentChart();
            updatePassRateHeatmap();
            updateGrade9SubjectsChart();
            updateAllGradesSubjectCharts();
        }

        // Year-over-year comparison function
        function showYearOverYearChanges(chartId, grades, dataKey) {
            console.log('Calculating year-over-year changes for', dataKey); // Debug log
            
            const comparisonData = grades.map(grade => {
                const gradeKey = `Grade_${grade}`;
                const data2023 = schoolData.summary['2023'].quarters.Q4[dataKey][gradeKey] || 0;
                const data2024 = schoolData.summary['2024'].quarters.Q4[dataKey][gradeKey] || 0;
                const data2025 = schoolData.summary['2025'].quarters.Q4[dataKey][gradeKey] || 0;
                
                const change2024 = data2023 > 0 ? ((data2024 - data2023) / data2023 * 100).toFixed(1) : 'N/A';
                const change2025 = data2024 > 0 ? ((data2025 - data2024) / data2024 * 100).toFixed(1) : 'N/A';
                
                let trend = 'stable';
                if (change2025 !== 'N/A') {
                    trend = parseFloat(change2025) > 0 ? 'up' : parseFloat(change2025) < 0 ? 'down' : 'stable';
                }
                
                return {
                    grade: gradeKey,
                    data2023: data2023,
                    data2024: data2024,
                    data2025: data2025,
                    change2024: change2024 + '%',
                    change2025: change2025 + '%',
                    trend: trend
                };
            });
            
            // Create comparison table
            const chartContainer = document.getElementById(chartId).parentElement;
            const existingTable = chartContainer.querySelector('.comparison-table');
            if (existingTable) {
                existingTable.remove();
            }
            
            const comparisonTable = document.createElement('div');
            comparisonTable.className = 'comparison-table';
            comparisonTable.innerHTML = `
                <h4 style="margin: 15px 0 10px 0; color: var(--primary-blue);">Year-over-Year Changes</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--gray-light);">
                            <th style="padding: 10px; text-align: left;">Grade</th>
                            <th style="padding: 10px;">2023</th>
                            <th style="padding: 10px;">2024</th>
                            <th style="padding: 10px;">2025</th>
                            <th style="padding: 10px;">2024‚Üí25</th>
                            <th style="padding: 10px;">Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${grades.map(grade => {
                            const data = comparisonData.find(d => d.grade === `Grade_${grade}`);
                            const trendColor = data.trend === 'up' ? '#51cf66' : data.trend === 'down' ? '#ff6b6b' : '#87ceeb';
                            const trendIcon = data.trend === 'up' ? '‚Üë' : data.trend === 'down' ? '‚Üì' : '‚Üí';
                            
                            return `
                                <tr>
                                    <td style="padding: 8px; font-weight: 600;">${data.grade}</td>
                                    <td style="padding: 8px;">${data.data2023}</td>
                                    <td style="padding: 8px;">${data.data2024}</td>
                                    <td style="padding: 8px;">${data.data2025}</td>
                                    <td style="padding: 8px; color: ${trendColor}; font-weight: 600;">${data.change2025}%</td>
                                    <td style="padding: 8px; text-align: center; color: ${trendColor}; font-weight: 600;">${trendIcon} ${data.trend}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            chartContainer.appendChild(comparisonTable);
        }

        // Enhanced year selector with comparison functionality
        let currentData = {};

        function updateEnrollmentChart() {
            console.log('Updating enrollment chart for year:', currentSelectedYear); // Debug log
            const ctx = document.getElementById('enrollmentChart').getContext('2d');
            const grades = ['R', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let datasets = [];
            
            if (currentSelectedYear === 'all') {
                datasets = [
                    {
                        label: '2023',
                        data: grades.map(g => schoolData.summary['2023'].quarters.Q4.enrollment[`Grade_${g}`] || 0),
                        borderColor: '#87ceeb',
                        backgroundColor: 'rgba(135, 206, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '2024',
                        data: grades.map(g => schoolData.summary['2024'].quarters.Q4.enrollment[`Grade_${g}`] || 0),
                        borderColor: '#00bfff',
                        backgroundColor: 'rgba(0, 191, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '2025',
                        data: grades.map(g => schoolData.summary['2025'].quarters.Q4.enrollment[`Grade_${g}`] || 0),
                        borderColor: '#87cefa',
                        backgroundColor: 'rgba(135, 206, 250, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ];
            } else {
                const yearData = schoolData.summary[currentSelectedYear].quarters.Q4.enrollment;
                datasets = [{
                    label: currentSelectedYear,
                    data: grades.map(g => yearData[`Grade_${g}`] || 0),
                    borderColor: '#00bfff',
                    backgroundColor: 'rgba(0, 191, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }];
                
                // Show comparison table for single year
                if (previousYear !== 'all' && previousYear !== currentSelectedYear) {
                    showYearOverYearChanges('enrollmentChart', grades, 'enrollment');
                }
            }
            
            currentData.enrollment = datasets;
            previousYear = currentSelectedYear;
            
            if (allCharts.enrollment) {
                allCharts.enrollment.destroy();
            }
            
            allCharts.enrollment = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: grades.map(g => `Grade ${g}`),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Enrollment by Grade ' + (currentSelectedYear === 'all' ? '(2023-2025)' : `(${currentSelectedYear})`)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Learners'
                            }
                        }
                    }
                }
            });
            
            previousYear = currentSelectedYear;
        }

        function updatePassRateHeatmap() {
            console.log('Updating pass rate heatmap for year:', currentSelectedYear); // Debug log
            const ctx = document.getElementById('passRateHeatmap').getContext('2d');
            const grades = ['R', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let datasets = [];
            
            if (currentSelectedYear === 'all') {
                datasets = ['2023', '2024', '2025'].map(year => ({
                    label: year,
                    data: grades.map(g => {
                        const rate = schoolData.summary[year].quarters.Q4.pass_rates[`Grade_${g}`] || 0;
                        return rate;
                    }),
                    backgroundColor: grades.map(g => {
                        const rate = schoolData.summary[year].quarters.Q4.pass_rates[`Grade_${g}`] || 0;
                        if (rate >= 80) return '#51cf66';
                        if (rate >= 70) return '#87ceeb';
                        if (rate >= 60) return '#ffd43b';
                        return '#ff6b6b';
                    })
                }));
            } else {
                const yearData = schoolData.summary[currentSelectedYear].quarters.Q4.pass_rates;
                datasets = [{
                    label: currentSelectedYear,
                    data: grades.map(g => yearData[`Grade_${g}`] || 0),
                    backgroundColor: grades.map(g => {
                        const rate = yearData[`Grade_${g}`] || 0;
                        if (rate >= 80) return '#51cf66';
                        if (rate >= 70) return '#87ceeb';
                        if (rate >= 60) return '#ffd43b';
                        return '#ff6b6b';
                    })
                }];
            }
            
            if (allCharts.passRate) {
                allCharts.passRate.destroy();
            }
            
            allCharts.passRate = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: grades.map(g => `Grade ${g}`),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Pass Rates by Grade ' + (currentSelectedYear === 'all' ? '(2023-2025)' : `(${currentSelectedYear}) (%)`)
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Pass Rate (%)'
                            }
                        }
                    }
                }
            });
        }

        function updateGrade9SubjectsChart() {
            const ctx = document.getElementById('grade9SubjectsChart').getContext('2d');
            const grade9Subjects = subjectData['2024']['Grade_9']; // Using actual Grade 9 data
            
            if (allCharts.grade9Subjects) {
                allCharts.grade9Subjects.destroy();
            }
            
            allCharts.grade9Subjects = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: grade9Subjects.map(s => s.name),
                    datasets: [{
                        label: 'Average Score (%)',
                        data: grade9Subjects.map(s => s.average),
                        backgroundColor: grade9Subjects.map(s => {
                            if (s.average >= 70) return '#51cf66';
                            if (s.average >= 60) return '#87ceeb';
                            if (s.average >= 50) return '#ffd43b';
                            return '#ff6b6b';
                        })
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Grade 9 Subject Performance ' + (currentSelectedYear === 'all' ? '(2024)' : `(${currentSelectedYear})`) + ' - Exit Year Preparation'
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Average Score (%)'
                            }
                        }
                    }
                }
            });
        }

        function updateAllGradesSubjectCharts() {
            // Update all grade subject charts (they only have 2024 data for now)
            const grades = ['Grade_4', 'Grade_5', 'Grade_6', 'Grade_7', 'Grade_8', 'Grade_9'];
            const chartIds = ['grade4SubjectsChart', 'grade5SubjectsChart', 'grade6SubjectsChart', 'grade7SubjectsChart', 'grade8SubjectsChart', 'grade9SubjectsChart'];
            
            grades.forEach((grade, index) => {
                const ctx = document.getElementById(chartIds[index]).getContext('2d');
                const subjects = subjectData['2024'][grade];
                
                if (allCharts[chartIds[index]]) {
                    allCharts[chartIds[index]].destroy();
                }
                
                allCharts[chartIds[index]] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: subjects.map(s => s.name.replace(' (Gr ' + grade.split('_')[1] + ')', '')),
                        datasets: [{
                            label: 'Average (%)',
                            data: subjects.map(s => s.average),
                            backgroundColor: subjects.map(s => {
                                if (s.average >= 70) return '#51cf66';
                                if (s.average >= 60) return '#87ceeb';
                                if (s.average >= 50) return '#ffd43b';
                                return '#ff6b6b';
                            })
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: { display: true, text: grade.replace('_', ' ') + ' Subjects (2024)' },
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100 }
                        }
                    }
                });
            });
        }

        // Handle window resize for responsive charts
        window.addEventListener('resize', function() {
            Chart.helpers.each(Chart.instances, function(instance) {
                instance.resize();
            });
        });

        // Infrastructure checklist functionality
        function setupInfrastructureChecklist() {
            const checkboxes = document.querySelectorAll('.check-item input[type="checkbox"]');
            const checkedCountEl = document.getElementById('checkedCount');
            const priorityCountEl = document.getElementById('priorityCount');
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateImprovementSummary);
            });
            
            updateImprovementSummary();
        }

        function updateImprovementSummary() {
            const checkboxes = document.querySelectorAll('.check-item input[type="checkbox"]');
            const checkedBoxes = document.querySelectorAll('.check-item input[type="checkbox"]:checked');
            const checkedCountEl = document.getElementById('checkedCount');
            const priorityCountEl = document.getElementById('priorityCount');
            
            const totalChecked = checkedBoxes.length;
            const priorityItems = Array.from(checkedBoxes).filter(cb => {
                const priorityCategories = ['classroom_maintenance', 'toilet_repairs', 'water_pressure', 'generator_backup', 'fence_repair', 'computer_lab_upgrade'];
                return priorityCategories.includes(cb.name);
            });
            
            checkedCountEl.textContent = totalChecked;
            priorityCountEl.textContent = priorityItems.length;
            
            // Save to localStorage for persistence
            const checkedItems = {};
            checkedBoxes.forEach(cb => {
                checkedItems[cb.name] = cb.checked;
            });
            localStorage.setItem('infrastructureImprovements', JSON.stringify(checkedItems));
        }

        function loadSavedImprovements() {
            const saved = localStorage.getItem('infrastructureImprovements');
            if (saved) {
                const checkedItems = JSON.parse(saved);
                Object.keys(checkedItems).forEach(itemName => {
                    const checkbox = document.querySelector(`input[name="${itemName}"]`);
                    if (checkbox) {
                        checkbox.checked = checkedItems[itemName];
                    }
                });
                updateImprovementSummary();
            }
        }
    </script>
</body>
</html>
